import pyspark
from pyspark.sql import SparkSession
spark = SparkSession.builder.getOrCreate()
sc=spark.sparkContext
 flights = spark.read.csv("data/flight-data/csv/2015-summary.csv")
flights.printSchema()
root
 |-- _c0: string (nullable = true)
 |-- _c1: string (nullable = true)
 |-- _c2: string (nullable = true)

 accChina = spark.sparkContext.accumulator(0)
flights = flights.toDF("DEST_COUNTRY_NAME", "ORIGIN_COUNTRY_NAME", "count")
flights.printSchema()
root
 |-- DEST_COUNTRY_NAME: string (nullable = true)
 |-- ORIGIN_COUNTRY_NAME: string (nullable = true)
 |-- count: string (nullable = true)

from pyspark.sql.functions import col

# تحويل العمود count إلى integer
flights = flights.withColumn("count", col("count").cast("int"))
def accChinaFunc(flight_row):
    DEST_COUNTRY_NAME = flight_row["DEST_COUNTRY_NAME"]
    ORIGIN_COUNTRY_NAME = flight_row["ORIGIN_COUNTRY_NAME"]
    if DEST_COUNTRY_NAME == "Italy":
        accChina.add(flight_row["count"])
    if ORIGIN_COUNTRY_NAME == "Italy":
        accChina.add(flight_row["count"])
flights = flights.toDF("DEST_COUNTRY_NAME", "ORIGIN_COUNTRY_NAME", "count")
flights.printSchema()
root
 |-- DEST_COUNTRY_NAME: string (nullable = true)
 |-- ORIGIN_COUNTRY_NAME: string (nullable = true)
 |-- count: integer (nullable = true)

accChina = spark.sparkContext.accumulator(0)
flights.foreach(accChinaFunc)
print(accChina.value)
820
 